<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
    <title>Token Color Mapper</title>
    <link rel="stylesheet" href="style.css">
    <script src="node_modules/three/build/three.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Token Color Mapper</h1>
        <p class="subtitle">Desktop — Open/Save files from the File menu or use the controls below.</p>

        <div class="controls">
            <div class="control-group">
                <label for="textInput">Enter Text:</label>
                <textarea id="textInput" placeholder="Type or paste your text here, or use File → Open Text File..."></textarea>
            </div>

            <div class="control-row">
                <div class="control-group">
                    <label for="tokenizeMode">Tokenize By:</label>
                    <select id="tokenizeMode">
                        <option value="words">Words (whitespace)</option>
                        <option value="chars">Characters</option>
                        <option value="lines">Lines</option>
                        <option value="custom">Custom separator</option>
                    </select>
                </div>
                <div class="control-group" id="customSepGroup" style="display: none;">
                    <label for="customSeparator">Separator (regex):</label>
                    <input type="text" id="customSeparator" placeholder="e.g. ,|;" value=",">
                </div>
            </div>

            <div class="control-group">
                <label for="modeSelect">Color Mapping Mode:</label>
                <select id="modeSelect">
                    <option value="standard">Standard (Deterministic)</option>
                    <option value="random">Random</option>
                </select>
            </div>

            <div class="control-group">
                <label for="pixelSize">Pixel Size: <span id="pixelSizeValue">10</span>px</label>
                <input type="range" id="pixelSize" min="1" max="50" value="10">
            </div>

            <div class="control-group">
                <label for="canvasShape">Canvas Shape:</label>
                <select id="canvasShape">
                    <option value="square">Square Grid</option>
                    <option value="rectangle">Rectangle (Wide)</option>
                    <option value="tall">Rectangle (Tall)</option>
                    <option value="circle">Circle</option>
                    <option value="spiral">Spiral</option>
                    <option value="triangle">Triangle</option>
                </select>
            </div>

            <div class="control-group">
                <label for="arrangementPattern">Arrangement Pattern:</label>
                <select id="arrangementPattern">
                    <option value="row-major">Row Major (Left to Right, Top to Bottom)</option>
                    <option value="column-major">Column Major (Top to Bottom, Left to Right)</option>
                    <option value="spiral-in">Spiral Inward</option>
                    <option value="spiral-out">Spiral Outward</option>
                    <option value="zigzag">Zigzag (Row)</option>
                    <option value="zigzag-col">Zigzag (Column)</option>
                    <option value="diagonal">Diagonal (Top-Left to Bottom-Right)</option>
                    <option value="random">Random</option>
                </select>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="emphasizeSimilarity" style="margin-right: 8px;">
                    Emphasize Color Similarity
                </label>
            </div>

            <div class="control-group" id="similarityThresholdGroup" style="display: none;">
                <label for="similarityThreshold">Similarity Threshold: <span id="similarityThresholdValue">50</span>%</label>
                <input type="range" id="similarityThreshold" min="0" max="100" value="50">
                <small style="color: #666; display: block; margin-top: 4px;">Lower values group more similar colors together</small>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="highlightTrends" style="margin-right: 8px;">
                    Highlight Pixel Trends
                </label>
            </div>

            <div class="control-group" id="trendControlsGroup" style="display: none;">
                <div style="margin-bottom: 10px;">
                    <label style="display: flex; align-items: center; margin-bottom: 8px;">
                        <input type="checkbox" id="trendHorizontal" checked style="margin-right: 8px;">
                        Horizontal
                    </label>
                    <label style="display: flex; align-items: center; margin-bottom: 8px;">
                        <input type="checkbox" id="trendVertical" checked style="margin-right: 8px;">
                        Vertical
                    </label>
                    <label style="display: flex; align-items: center; margin-bottom: 8px;">
                        <input type="checkbox" id="trendDiagonal" checked style="margin-right: 8px;">
                        Diagonal
                    </label>
                </div>
                <label for="trendMinLength">Minimum Trend Length: <span id="trendMinLengthValue">3</span> pixels</label>
                <input type="range" id="trendMinLength" min="2" max="10" value="3">
                <label for="trendSimilarity" style="margin-top: 10px;">Trend Similarity Threshold: <span id="trendSimilarityValue">30</span>%</label>
                <input type="range" id="trendSimilarity" min="0" max="100" value="30">
                <label for="trendOpacity" style="margin-top: 10px;">Highlight Opacity: <span id="trendOpacityValue">50</span>%</label>
                <input type="range" id="trendOpacity" min="0" max="100" value="50">
                <label for="highlightColor" style="margin-top: 10px;">Highlight Color:</label>
                <input type="color" id="highlightColor" value="#ffff00" style="width: 100%; height: 40px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;">
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="view3D" style="margin-right: 8px;">
                    Enable 3D View
                </label>
            </div>

            <div class="control-group" id="view3DControlsGroup" style="display: none;">
                <label for="pointSize3D">Point Size: <span id="pointSize3DValue">0.1</span></label>
                <input type="range" id="pointSize3D" min="0.01" max="0.5" step="0.01" value="0.1">
                <label style="margin-top: 10px;">
                    <input type="checkbox" id="showLines3D" style="margin-right: 8px;">
                    Show Plotting Path Lines
                </label>
            </div>

            <div class="control-group video-export-section">
                <label class="video-export-heading">Video export</label>
                <p class="video-export-note">Record animated plotting in <strong>3D Color Space</strong> (RGB cube). Enable <strong>RGB 3D View</strong> above first, then click Start.</p>
                <label for="videoExportRes">Resolution (width × height):</label>
                <select id="videoExportRes">
                    <option value="1920x1080">1080p (1920×1080)</option>
                    <option value="2560x1440">2K (2560×1440)</option>
                    <option value="3840x2160">4K (3840×2160)</option>
                    <option value="7680x4320">8K (7680×4320)</option>
                    <option value="custom">Custom…</option>
                </select>
                <div id="videoExportCustomGroup" style="display: none; margin-top: 8px;">
                    <input type="number" id="videoExportWidth" placeholder="Width" min="320" max="16384" value="1920" style="width: 48%; padding: 6px;">
                    <span>×</span>
                    <input type="number" id="videoExportHeight" placeholder="Height" min="240" max="16384" value="1080" style="width: 48%; padding: 6px;">
                </div>
                <label for="plotSpeed3D" style="margin-top: 10px;">Plotting speed: <span id="plotSpeed3DValue">1</span> points/frame</label>
                <input type="range" id="plotSpeed3D" min="0.1" max="10" step="0.1" value="1">
                <button id="startVideoExportBtn" style="margin-top: 10px; padding: 10px 20px; background: #4facfe; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">Start Video Export</button>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="viewRGB3D" style="margin-right: 8px;">
                    Enable RGB 3D View (Color Space)
                </label>
            </div>

            <div class="control-group" id="rgb3DControlsGroup" style="display: none;">
                <label for="rgb3DShape">Point Shape:</label>
                <select id="rgb3DShape">
                    <option value="sphere">Sphere</option>
                    <option value="cube">Cube</option>
                </select>
                <label style="margin-top: 10px;">
                    <input type="checkbox" id="rgb3DShowPath" style="margin-right: 8px;">
                    Show Plotting Path
                </label>
            </div>

            <div class="control-group">
                <label for="exportScale">Export Image Scale:</label>
                <select id="exportScale">
                    <option value="2">2×</option>
                    <option value="4" selected>4×</option>
                    <option value="8">8×</option>
                    <option value="16">16×</option>
                    <option value="32">32×</option>
                    <option value="64">64×</option>
                    <option value="128">128×</option>
                    <option value="256">256×</option>
                    <option value="custom">Custom…</option>
                </select>
                <div id="exportScaleCustomGroup" style="display: none; margin-top: 8px;">
                    <label for="exportScaleCustom">Scale factor (1–512):</label>
                    <input type="number" id="exportScaleCustom" min="1" max="512" value="64" style="width: 100%; padding: 8px;">
                </div>
                <small style="color: #666;">Very high scale = large file, print/posters. Max dimension 32,768px.</small>
            </div>

            <div class="button-group">
                <button id="openFileBtn">Open File...</button>
                <button id="saveTextBtn">Save Text...</button>
                <button id="randomizeBtn">Re-randomize Colors</button>
                <button id="exportImageBtn">Export High-Res Image</button>
                <button id="downloadJsonBtn">Download Color Mapping (JSON)</button>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="colorCanvas"></canvas>
            <div id="canvas3D" style="display: none; width: 100%; height: 600px;"></div>
            <div id="canvasRGB3D" style="display: none; width: 100%; height: 600px;"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
